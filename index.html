<!DOCTYPE html>
<html lang="so">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Alifpay</title>
<style>
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;padding:18px;background:#f7f7fb;color:#222;}
.container{max-width:720px;margin:0 auto;background:#fff;padding:18px;border-radius:10px;box-shadow:0 6px 20px rgba(20,20,60,0.06);}
input, button{padding:10px;margin:6px 0;width:100%;border-radius:6px;box-sizing:border-box;}
button{background:#2563eb;color:#fff;border:none;cursor:pointer;}
.hidden{display:none;}
.status{color:#444;font-size:14px;margin-top:6px;}
</style>
</head>
<body>
<div class="container">
<h1>Alif wallet</h1>

<section id="signupSection">
  <h2>Signup</h2>
  <input id="nameInput" placeholder="Magacaaga" />
  <input id="contactInput" placeholder="Email ama Phone" />
  <input id="passwordInput" type="password" placeholder="Password" />
  <button id="signupBtn">Codso OTP</button>
  <div class="status" id="signupStatus"></div>
</section>

<section id="otpSection" class="hidden">
  <h2>Geli OTP</h2>
  <input id="otpInput" placeholder="OTP" />
  <button id="verifyOtpBtn">Verify OTP</button>
  <div class="status" id="otpStatus"></div>
</section>

<section id="walletSection" class="hidden">
  <h2>Wallet Dashboard</h2>
  <div><b>Address:</b> <span id="meAddr"></span></div>
  <div><b>Balance:</b> <span id="meBal"></span></div>
  <button id="logoutBtn" style="background:#ef4444;">Logout</button>
</section>
</div>

<script src="https://cdn.jsdelivr.net/npm/appwrite@8.1.1/dist/appwrite.min.js"></script>
<script>
const client = new Appwrite.Client();
client.setEndpoint("YOUR_APPWRITE_ENDPOINT/v1").setProject("YOUR_PROJECT_ID");
const database = new Appwrite.Database(client);
const functions = new Appwrite.Functions(client);

const signupSection = document.getElementById('signupSection');
const otpSection = document.getElementById('otpSection');
const walletSection = document.getElementById('walletSection');

const nameInput = document.getElementById('nameInput');
const contactInput = document.getElementById('contactInput');
const passwordInput = document.getElementById('passwordInput');
const signupBtn = document.getElementById('signupBtn');
const signupStatus = document.getElementById('signupStatus');

const otpInput = document.getElementById('otpInput');
const verifyOtpBtn = document.getElementById('verifyOtpBtn');
const otpStatus = document.getElementById('otpStatus');

const meAddr = document.getElementById('meAddr');
const meBal = document.getElementById('meBal');
const logoutBtn = document.getElementById('logoutBtn');

let currentUser = null;

signupBtn.onclick = async () => {
  const name = nameInput.value.trim();
  const contact = contactInput.value.trim();
  const password = passwordInput.value.trim();
  if(!name || !contact || !password){ signupStatus.textContent="Geli dhammaan xogta"; return; }

  const doc = await database.createDocument('YOUR_USERS_COLLECTION_ID', 'unique()', {
    name, contact, password, address:'0x'+Math.random().toString(16).slice(2,18), balance:1000, createdAt:new Date().toISOString()
  });

  currentUser = doc;

  await functions.createExecution('YOUR_OTP_FUNCTION_ID', JSON.stringify({ contact }));

  signupSection.classList.add('hidden');
  otpSection.classList.remove('hidden');
  signupStatus.textContent="OTP waa la diray!";
};

verifyOtpBtn.onclick = async () => {
  const otp = otpInput.value.trim();
  if(!otp){ otpStatus.textContent="Geli OTP"; return; }

  const doc = await database.getDocument('YOUR_USERS_COLLECTION_ID', currentUser.$id);
  if(doc.otp === otp && new Date(doc.otpExpiry) > new Date()){
    otpStatus.textContent="OTP sax ah!";
    otpSection.classList.add('hidden');
    walletSection.classList.remove('hidden');
    meAddr.textContent = doc.address;
    meBal.textContent = doc.balance;
  } else {
    otpStatus.textContent="OTP khalad ama dhacay!";
  }
};

logoutBtn.onclick = () => {
  currentUser = null;
  walletSection.classList.add('hidden');
  signupSection.classList.remove('hidden');
};
</script>
</body>
</html>
